= brr-base-tf-resources

my local role arn

 * arn:aws:sts::792981815698:assumed-role/AWSReservedSSO_AdministratorAccess_eeb8e63974797d2b/brrAwsIdentity

* https://manski.net/articles/github/actions/cheat-sheet
* https://medium.com/@ayushishrot/how-to-automate-terraform-deployments-with-github-actions-a-step-by-step-guide-3af1ec203bb5
*

aws eks create-access-entry \
--cluster-name my-eks-cluster-example-1-xNRn9CZU \
--principal-arn arn:aws:iam::792981815698:role/aws-reserved/sso.amazonaws.com/us-east-2/AWSReservedSSO_AdministratorAccess_eeb8e63974797d2b \
--type STANDARD \
--region us-east-2


aws eks create-access-entry \
--cluster-name my-eks-cluster-example-1-f9tbDfzd \
--principal-arn arn:aws:iam::792981815698:role/aws-reserved/sso.amazonaws.com/us-east-2/AWSReservedSSO_AdministratorAccess_eeb8e63974797d2b \
--type STANDARD \
--region us-east-2

aws eks create-access-entry \
--cluster-name my-eks-cluster-example-1-f9tbDfzd \
--principal-arn arn:aws:iam::792981815698:role/github_oidc_ci_assume_role \
--type STANDARD \
--region us-east-2

// oidc role trust policy

{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "arn:aws:iam::792981815698:oidc-provider/token.actions.githubusercontent.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
},
"StringLike": {
"token.actions.githubusercontent.com:sub": "repo:benrhine/brr-base-tf-resources:ref:refs/heads/main"
}
}
}
]
}

{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"eks:*"
],
"Resource": "*"
}
]
}

== Reference

* https://blog.saintmalik.me/argocd-on-kubernetes-cluster/
* https://registry.terraform.io/modules/squareops/argocd/kubernetes/latest
** Module for creation
* https://dev.to/aws-builders/gitops-with-argocd-on-amazon-eks-using-terraform-a-complete-implementation-guide-1inc
** interesting as it sets argo up with a custom domain
*